<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="sl-gallery-image.html">
<link rel="import" href="sl-gallery-slideshow.html">

<dom-module id="sl-gallery">
  <template>
    <style>
      :host {
        display: block;
        overflow: hidden;

        --sl-gallery-columns: 4;
        --sl-gallery-gutter: 8px;
        --sl-gallery-item-height: 75%;
      }

      .image-grid {
        display: -ms-flexbox;
        display: -webkit-flex;
        display: flex;

        -ms-flex-direction: row;
        -webkit-flex-direction: row;
        flex-direction: row;

        -ms-flex-wrap: wrap;
        -webkit-flex-wrap: wrap;
        flex-wrap: wrap;

        padding-top: var(--sl-gallery-gutter, 0px);
        padding-left: var(--sl-gallery-gutter, 0px);
        box-sizing: border-box;

        /* @override, hide gutter around grid */
        padding: 0;
        margin: 0 calc(-1 * var(--sl-gallery-gutter, 0px)) calc(-1 * var(--sl-gallery-gutter, 0px)) 0;
      }

      :host([invisible]) .image-grid {
        display: none;
      }
    </style>

    <div class="image-grid" on-click="_handleGridClicked">
      <slot></slot>
    </div>
  </template>

  <script>
    /**
     * Silverlinkz Photo Gallery
     * A Polymer photo gallery.
     *
     * @customElement
     * @polymer
     * @demo demo/index.html
     */
    class SLGallery extends Polymer.Element {

      static get is() { return 'sl-gallery'; }

      static get properties() {
        return {
          active: {
            type: Boolean,
            value: true,
          },
          _images: {
            type: Array,
            observer: '_imagesChanged',
          },
          index: {
            type: Number,
            observer: '_indexChanged'
          }
        };
      }

      static get observers() {
        return [
        ];
      }

      constructor() {
        super();

        // Create slideshow element, keep handle as this.slideshow
        this.slideshow = document.createElement('sl-gallery-slideshow');

        // Create reference to local scope in slideshow
        this.slideshow.gallery = this;

        // Hide slideshow before appending to prevent potential flash of content
        this.slideshow.hidden = true;

        // Append slideshow to root custom-element
        document.body.appendChild(this.slideshow);
      }

      open() {
        this._images = [...this.querySelectorAll('sl-gallery-image')].map((image, index) => {
          image.index = index;
          return image
        });
        this.index = 0;

        if (this._images && this._images[this.index]) {
          this.slideshow.opened = true;
        } else {
          this.slideshow.opened = false;
        }
      }

      close() {
        this.slideshow.opened = false;
        this.index = null;
        this._images = null;
        this.slideshow.clean();
      }

      _indexChanged(index) {
        if (index === null || !this._images) {
          this.slideshow.activeImage = undefined;
        } else {
          this.slideshow.activeImage = this._images[index];
        }
      }

    }

    window.customElements.define(SLGallery.is, SLGallery);
  </script>
</dom-module>
